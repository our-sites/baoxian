{% extends "m_base.html" %}
{% block header_title %}用户登录{% endblock %}
{% block title %}用户登录-保险管家{% endblock %}
{% block keywords %}用户登录 保险管家{% endblock %}
{% block description %}用户登录 保险管家{% endblock %}
{% block content %}
    <div class="row row-content" style="padding-top: 50px">
        <form class="col-xs-offset-1  col-xs-10 form-horizontal" role="form" id="main-form" method="post"
        action="/login/?next={% if next_to %}{{ next_to|urlencode }}{% endif %}{% if role %}&role={{ role }}{% endif %}">
            {% csrf_token %}

            <div class="form-group">
                {#                        <label for="firstname" class="col-xs-4 control-label">手机号：</label>#}
                <div class="col-xs-12">
                    <input type="text" class="form-control"
                           placeholder="手机号" id="username" name="username">
                </div>
            </div>


            <div class="form-group">
                {#                        <label for="firstname" class="col-xs-4 control-label">手机号：</label>#}
                <div class="col-xs-12">
                    <input class="form-control"
                           placeholder="密码" id="password" name="password" type="password">
                </div>
            </div>


            <div class="form-group">
                <div class="col-xs-12">
                    <div>
                        <button type="submit" class="btn btn-primary  btn-block" style="width: 100%">提交</button>
                    </div>

                </div>
            </div>
        </form>
    </div>
    <div class="row row-content">
    <div class="col-xs-offset-1 col-xs-10" >
        <a href="/register/">注册</a>
        <a href="/forgotpwd/" class="pull-right">忘记密码</a>
    </div>

    </div>
    <div>

                            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                            <h4 class="modal-title" id="myModalLabel"></h4>
                                        </div>
                                        <div class="modal-body" id="myModeal-body">

                                        </div>
{#                                        <div class="modal-footer">#}
{#                                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>#}
{#                                            <a  href="/logout/?next=/" type="button" class="btn btn-primary">确定</a>#}
{#                                        </div>#}
                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>
    </div>
{% endblock %}
{% block footer %}
{% endblock %}
{% block customjs %}
    <script src="/static/jquery.validater.min.js"></script>
    <script src="/static/js/distpicker/distpicker.js"></script>
    <script>
        jQuery.validator.addMethod("isMobile", function (value, element) {
            var length = value.length;
            var mobile = /^(1[0-9]{2}\d{8})$/;
            return this.optional(element) || (length == 11 && mobile.test(value));
        }, "请正确填写您的手机号码");

        function modal_message(message,msec){
            jQuery("#myModeal-body").text(message);
            jQuery("#myModal").modal("show");
            setTimeout(function(){
                jQuery("#myModal").modal("hide");

            },msec)
        }
        function direct_302(address,msec){
            setTimeout(function(){
                 window.location.href=address
            },msec);
        }
        function process_response(data){
            var errcode=data.errorCode;
            if (errcode){
                var errmessage=data.formError.fields[0].msg;
                modal_message(errmessage,1200);
            }
            else {
                var successmsg=data.msg;
                var direct_to=data.formSuccess.redirect;
                var msec=data.formSuccess.duration;
                modal_message(successmsg,1200);
                direct_302(direct_to,msec)
            }
        }

        $(document).ready(function () {


            $("#main-form").validate({
                        rules: {
                            username: {
                                required: true,
                                isMobile: true
                            },

                            password:{
                                required:true
                            }

                        },
                        messages: {
                            username: {
                                required: "请输入手机号"
                            },

                            password:{
                                required:"请填写密码"
                            }
                        },

                        submitHandler:function(form){
                            jQuery.ajax({
                                type:"POST",
                                dataType:"json",
                                data: jQuery(form).serialize(),
                                success:function(data){
                                    process_response(data);
                                }

                            })
                        }

                    }
            );
        });

    </script>
{% endblock %}